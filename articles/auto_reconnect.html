<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html class="theme-dark">
  
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Auto reconnect </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="title" content="Auto reconnect ">
    <meta name="generator" content="docfx 2.58.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.css" integrity="sha512-T3VL1q6jMUIzGLRB9z86oJg9PgF7A55eC2XkB93zyWSqQw3Ju+6IEJZYBfT7E9wOHM7HCMCOZSpcssxnUn6AeQ==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/stackoverflow-dark.min.css" integrity="sha512-Xn1b0y/BrCD7usnEh6r9CcKxHXFVleVUjGDnfc95zDDwFUwtOz3lJC/XtJcuLRNyrMQJEEToFfwjC9Ue/aWY/g==" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/stackoverflow-light.min.css" integrity="sha512-RDtnAhiPytLVV3AwzHkGVMVI4szjtSjxxyhDaH3gqdHPIw5qwQld1MVGuMu1EYoof+CaEccrO3zUVb13hQFU/A==" crossorigin="anonymous" disabled="disabled">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/solid.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="../styles/colors.css">
    <link rel="stylesheet" href="../styles/discord.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../">
    
  </head>

  <body>

        <div class="body-content">

            <nav id="sidebar" role="navigation">

                <div class="sidebar">
                    
                    
                    
                    
                    <div>
                      
                      <a class="brand" href="../index.html">
                        <img src="../logo.svg" alt="alt:V" class="logomark">
                        <span class="brand-title">alt:V</span>
                      </a>
                      <div id="navbar">
                    
                      </div>
                    
                    </div>
                    


                </div>


            </nav>

            <main class="main-panel">

                <div class="blackout desktop-hide"></div>

                    
                    <div class="subnav navbar navbar-default">
                      <button class="btn-link search-back desktop-hide"></button>
                      <button class="btn-link navbar-toggler" aria-label="Toggle navigation"></button>
                      <div class="container" id="breadcrumb">
                        <ul class="breadcrumb">
                          <li></li>
                        </ul>
                      </div>
                      <div class="flex-space"></div>
                      <div class="toolbar">
                          <div style="position: relative; margin: 0 8px;">
                            <form class="search-bar mobile-hide" role="search" id="search" style="position: relative;">
                              <button class="btn-link clear" id="search-query-clear"></button>
                              <div role="textbox" class="form-control" id="search-query" placeholder="Search" contenteditable="true"></div>
                            </form>
                            <div class="popout" id="search-menu">
                                <button class="btn-link search-help" data-href="../articles/search_help.html"></button>
                              <span class="title">
                                Search options:
                              </span>
                            </div>
                            <button class="btn-link search-tip desktop-hide"></button>
                          </div>
                      </div>
                      <button class="btn-link btn-floating search desktop-hide"></button>
                      <div class="theme">
                        <button class="btn-link theme" aria-label="Switch theme"></button>
                        <div class="popout" id="theme-menu">
                          <div class="theme-option light" data-theme="light">
                            <span class="btn-link theme-light">Light</span>
                          </div>
                          <div class="theme-option dark" data-theme="dark">
                            <span class="btn-link theme-dark">Dark</span>
                          </div>
                          <div class="theme-option auto" data-theme="auto">
                            <span class="btn-link theme-auto">Sync with OS</span>
                          </div>
                        </div>
                      </div>
                    </div>

                <div class="content-region" role="main">

                    <div class="content-column Conceptual">

                            
                            <div class="sideaffix hide-when-search" data-noindex="">
                              <h3>Index</h3>
                              <div class="bs-docs-sidebar affix" id="affix"><ul class="level1 nav bs-docs-sidenav"><li><a href="#auto-reconnect">Auto reconnect</a><ul class="level2 nav bs-docs-sidenav auto-reconnect"><li><a href="#what-is-auto-reconnect">What is auto reconnect</a></li><li><a href="#script-usage">Script usage</a></li></ul></li></ul></div>
                            </div>

                            
                            <div id="search-results">
                              <div class="search-list">Search Results for <span></span></div>
                              <div class="sr-items">
                                <p><span class="glyphicon glyphicon-refresh index-loading"></span></p>
                              </div>
                              <ul id="pagination" data-first="" data-prev="&#xf053;" data-next="&#xf054;" data-last=""></ul>
                            </div>

                        <article class="content wrap hide-when-search" id="_content" data-uid="">

                                <span class="small pull-right article mobile-hide" style="margin: 0;" data-noindex="">
                                    <ul class="subnav contribution">
                                            <li>
                                                <a href="https://github.com/altmp/altv-docs/blob/master/articles/auto_reconnect.md/#L1">Improve this Doc</a>
                                            </li>
                                    </ul>
                                </span>

<h1 id="auto-reconnect">Auto reconnect</h1>

<p>This article will explain the auto reconnect feature introduced in the 9.0 update.</p>
<h2 id="what-is-auto-reconnect">What is auto reconnect</h2>
<p>The auto reconnect allows the server to send a post request to the local client in order to initialize a connection /
reconnection to the server.<br>
This feature is only available when the client and server are in debug mode and is intended for a smoother local
development.<br>
It is important to note that you can also send the post request when you want, meaning it's possible to wait for your
server to finish his startup procedure (fetching data from database, loading modules..).</p>
<h2 id="script-usage">Script usage</h2>
<div class="tabGroup" id="tabgroup_bHGHmlrG6S">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_tabid-1" role="tab" aria-controls="tabpanel_bHGHmlrG6S_tabid-1" data-tab="tabid-1" tabindex="0" aria-selected="true">Javascript</a>
</li>
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_tabid-2" role="tab" aria-controls="tabpanel_bHGHmlrG6S_tabid-2" data-tab="tabid-2" tabindex="-1">Typescript</a>
</li>
<li role="presentation">
<a href="#tabpanel_bHGHmlrG6S_tabid-3" role="tab" aria-controls="tabpanel_bHGHmlrG6S_tabid-3" data-tab="tabid-3" tabindex="-1">C#</a>
</li>
</ul>
<section id="tabpanel_bHGHmlrG6S_tabid-1" role="tabpanel" data-tab="tabid-1">

<pre><code class="lang-js">const RETRY_DELAY = 2500;
const DEBUG_PORT = 9223;

async function getLocalClientStatus() {
  try {
    const response = await fetch(`http://127.0.0.1:${DEBUG_PORT}/status`);
    return response.text();
  } catch (error) {
    return null;
  }
}

async function connectLocalClient() {
  const status = await getLocalClientStatus();
  if (status === null) return;

  if (status !== &quot;MAIN_MENU&quot; &amp;&amp; status !== &quot;IN_GAME&quot;) {
    setTimeout(() =&gt; connectLocalClient(), RETRY_DELAY);
    return;
  }

  try {
    await fetch(`http://127.0.0.1:${DEBUG_PORT}/reconnect`, {
      method: &quot;POST&quot;,
      body: &quot;serverPassword&quot;, // only needed when a password is set in the server.toml
    });
  } catch (error) {
    console.log(error);
  }
}

connectLocalClient();
</code></pre>
</section>
<section id="tabpanel_bHGHmlrG6S_tabid-2" role="tabpanel" data-tab="tabid-2" aria-hidden="true" hidden="hidden">

<pre><code class="lang-ts">const enum Status {
  Loading = &quot;LOADING&quot;,
  MainMenu = &quot;MAIN_MENU&quot;,
  DownloadingFiles = &quot;DOWNLOADING_FILES&quot;,
  Connecting = &quot;CONNECTING&quot;,
  InGame = &quot;IN_GAME&quot;,
  Disconnecting = &quot;DISCONNECTING&quot;,
  Error = &quot;ERROR&quot;,
}

const RETRY_DELAY = 2500;
const DEBUG_PORT = 9223;

async function getLocalClientStatus(): Promise&lt;Status | null&gt; {
  try {
    const response = await fetch(`http://127.0.0.1:${DEBUG_PORT}/status`);
    return response.text() as unknown as Status;
  } catch (error) {
    return null;
  }
}

async function connectLocalClient(): Promise&lt;void&gt; {
  const status = await getLocalClientStatus();
  if (status === null) return;

  if (status !== Status.MainMenu &amp;&amp; status !== Status.InGame) {
    setTimeout(() =&gt; connectLocalClient(), RETRY_DELAY);
    return;
  }

  try {
    await fetch(`http://127.0.0.1:${DEBUG_PORT}/reconnect`, {
      method: &quot;POST&quot;,
      body: &quot;serverPassword&quot;, // only needed when a password is set in the server.toml
    });
  } catch (error) {
    console.log(error);
  }
}

connectLocalClient();
</code></pre>
</section>
<section id="tabpanel_bHGHmlrG6S_tabid-3" role="tabpanel" data-tab="tabid-3" aria-hidden="true" hidden="hidden">

<pre><code class="lang-csharp">using AltV.Net.Async;
using System.Runtime.Serialization;
using Timer = System.Timers.Timer;

namespace Example
{
    class ExampleResource : AsyncResource
    {
        private const int DebugPort = 9223;
        private const int RetryDelay = 2500;

        private readonly HttpClient _httpClient = new();
        private readonly Timer _timer = new(RetryDelay);

        private enum ClientStatus
        {
            [EnumMember(Value = &quot;LOADING&quot;)] Loading,
            [EnumMember(Value = &quot;MAIN_MENU&quot;)] MainMenu,
            [EnumMember(Value = &quot;DOWNLOADING_FILES&quot;)] DownloadingFiles,
            [EnumMember(Value = &quot;CONNECTING&quot;)] Connecting,
            [EnumMember(Value = &quot;IN_GAME&quot;)] InGame,
            [EnumMember(Value = &quot;DISCONNECTING&quot;)] Disconnecting,
            [EnumMember(Value = &quot;ERROR&quot;)] Error
        }

        private async Task&lt;ClientStatus&gt; GetLocalClientStatus()
        {
            try
            {
                var status = await _httpClient.GetStringAsync($&quot;http://127.0.0.1:{DebugPort}/status&quot;);
                var enumValue = typeof(ClientStatus).GetFields()
                    .FirstOrDefault(f =&gt; f.GetCustomAttribute&lt;EnumMemberAttribute&gt;()?.Value == status)?
                    .GetValue(null);

                return enumValue != null ? (ClientStatus)enumValue : ClientStatus.Error;
            }
            catch
            {
                return ClientStatus.Error;
            }
        }

        private async Task ConnectLocalClient()
        {
            var status = await GetLocalClientStatus();
            if (status == ClientStatus.Error) return;
            if (status != ClientStatus.MainMenu &amp;&amp; status != ClientStatus.InGame &amp;&amp; !_timer.Enabled)
            {
                _timer.Start();
                return;
            }
            if (status == ClientStatus.InGame &amp;&amp; _timer.Enabled)
            {
                _timer.Stop();
                return;
            }

            try
            {
                await _httpClient.PostAsync(
                    $&quot;http://127.0.0.1:{DebugPort}/reconnect&quot;,
                    // Only needed when a password is set in the server.toml, otherwise pass null instead of StringContent
                    new StringContent(&quot;serverPassword&quot;)
                );
            }
            catch (Exception ex)
            {
                Console.WriteLine($&quot;Reconnect failed: {ex}&quot;);
            }
        }

        public override void OnStart()
        {
            _timer.Elapsed += (_, _) =&gt; _ = ConnectLocalClient();
            _ = ConnectLocalClient();
        }

        public override void OnStop()
        {
        }
    }
}
</code></pre>
</section>
</div>
</article>
                    </div>

                </div>

            </main>

        </div>

        
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/arrive/2.4.1/arrive.min.js" integrity="sha512-wkU3qYWjenbM+t2cmvw2ADRRh4opbOYBjkhrPGHV7M6dcE/TR0oKpoDkWXfUs3HrulI2JFuTQyqPLRih1V54EQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twbs-pagination/1.4.2/jquery.twbsPagination.min.js" integrity="sha512-frFP3ZxLshB4CErXkPVEXnd5ingvYYtYhE5qllGdZmcOlRKNEPbufyupfdSTNmoF5ICaQNO6SenXzOZvoGkiIA==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.js" integrity="sha512-ztxZscxb55lKL+xmWGZEbBHekIzy+1qYKHGZTWZYH1GUwxy0hiA18lW6ORIMj4DHRgvmP/qGcvqwEyFFV7OYVQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js" integrity="sha512-G2OGlm41XXw+fcgDcRPjVYEn7qCY6qiKWNqDGT37SnKh0qtRXTuKZ5/UQR0kDN0PZRNWcGExd3lAeqEH0I36bQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-url/1.8.8/url.min.js" integrity="sha512-r7Z8tYN1iMr6CTQ7pNJa2q+3owm4Tc6dLkVzGV68AFGiI0muMh5eLVQlas5kb9qwPY168HsTBctUwn3k0FVqyw==" crossorigin="anonymous"></script>
<script type="text/javascript" src="../styles/docfx.js"></script>
<script type="text/javascript" src="../styles/discord.js"></script>
<script type="text/javascript" src="../styles/main.js"></script>

    </body>

</html>
